name: Cusymint
repository: https://github.com/szymon-zygula/cusymint

packages:
  - front/**

ide:
  intellij: false

scripts:
  generate:
    run: |
      melos exec -- \
        "flutter packages pub run build_runner build --delete-conflicting-outputs"
    select-package:
      depends-on: 
        - build_runner

  rebuild:icons:
    run: |
      melos exec -- \
        "flutter pub run flutter_launcher_icons:main"
    select-package:
      depends-on: 
        - flutter_launcher_icons
  
  rebuild:splash:
    run: |
      melos exec -- \
        "flutter pub run flutter_native_splash:create"
    select-package:
      depends-on: 
        - flutter_native_splash

  analyze:
    run: melos exec -c 1 -- "dart analyze . --fatal-infos"

  test:unit:all:
    run: melos run test:unit --no-select

  test:unit:
    run: |
      melos exec -c 6 --fail-fast -- \
        "flutter test --no-pub"
    select-package:
      dir-exists:
        - test
  
  test:integration:
    run: |
      melos exec -c 6 --fail-fast -- \
        "dart test integration_test"
    select-package:
      dir-exists:
        - integration_test

  format-check:
    run: melos exec flutter format . --set-exit-if-changed

  build:web:
    run: melos exec --fail-fast -- \
      "flutter build web"
    select-package:
      dir-exists:
        - web
      scope: 'cusymint_app'

  build:linux:
    run: melos exec --fail-fast -- \
      "flutter build linux"
    select-package:
      dir-exists:
        - linux
      scope: 'cusymint_app'

  build:windows:
    run: melos exec --fail-fast -- \
      "flutter build windows"
    select-package:
      dir-exists:
        - windows
      scope: 'cusymint_app'

  build:android:
    run: melos exec --fail-fast -- \
      "flutter build apk --split-per-abi"
    select-package:
      dir-exists:
        - android
      scope: 'cusymint_app'

command:
  bootstrap:
    usePubspecOverrides: true
